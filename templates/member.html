<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- ì‹œê°„ ì²˜ë¦¬ Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="../static/js/ggamchingMode.js"></script>
    <link rel="stylesheet" href="../static/css/global.css" />
    <link rel="stylesheet" href="../static/css/member.css" />
    <!-- ì›¹ì¢…ë°˜ ê°•ì˜ì—ì„œ ì´ê²Œ ë¶€íŠ¸ìŠ¤íŠ¸ë©ì„ ê°€ì ¸ì˜¬ ë•Œ ì¨ì•¼í•˜ëŠ” ì½”ë“œë¼ê³  í•˜ë˜ë° ë§Œì•½ ì˜ëª»í•œ ê±°ë©´...ì£„ì†¡í•©ë‹ˆë‹¤... -->

    <title>Member</title>
    <script>
      $(document).ready(function () {
        get_member();
        get_rolling();
        isGgamchingMode();
      });

      // URLì—ì„œ ë©¤ë²„ ì•„ì´ë”” ê°€ì ¸ì˜¤ê¸°
      function getMemberIdFromURL() {
        return location.href.split('/member/')[1];
      }

      function get_member() {
        fetch(`/api/member/${getMemberIdFromURL()}`)
          .then((res) => res.json())
          .then((data) => {
            const { result, data: member } = data;
            if (result !== 'success') {
              alert(data.message);
              history.back();
              return;
            }
            $('#member-image').empty();
            const imageTag = `
            <img
            src="${member.img}"
            alt="${member.name}"
          />
            `;
            $('#member-image').append(imageTag);
            $('#member-info').empty();
            const html = `
          <span>â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â¤ï¸â­</span>
          <span>
            ì•ˆë…•í•˜ì„¸ìš”! ğŸ™Œ <br />
            â­ì•Œì½©ì½©~ë‹¬ì½©ì½©~ğŸ’• ${member.role === 'leader' ? 'íŒ€ì¥' : 'íŒ€ì›'} ${
              member.name
            }ì…ë‹ˆë‹¤.
          </span>
          <span>ì €ëŠ” ${member.location}ì— ì‚´ê³ ìˆì–´ìš”.</span>
          <span>ì œ MBTIëŠ” ${member.mbti}ì…ë‹ˆë‹¤.</span>
          <span>ì‰¬ëŠ” ë‚ ì—” ${member.hobby.join(', ')}ë¥¼ ì¦ê²¨ìš”.</span>
          <span
            >ì œ GitHubëŠ”
            <a href="https://github.com/${member.memberId}" target="_blank"
              >ì—¬ê¸°</a
            >ë¥¼ ëˆŒëŸ¬ì£¼ì‹œë©´ ë³¼ ìˆ˜ ìˆì–´ìš”.</span
          >
          <span>ëª¨ë‘ë“¤ ì˜ ë¶€íƒë“œë ¤ìš”!ğŸ˜</span>
          <br/>
          <span>ë§ˆì§€ë§‰ìœ¼ë¡œ ìš”ì¦˜ ì œê°€ ì¦ê²¨ ë“£ëŠ” ë…¸ë˜ì—ìš”. êµ¬ê²½í•˜ì‹œë©´ì„œ ë“¤ì–´ì£¼ì„¸ìš”!</span>
          <iframe width="560" height="315" src="https://www.youtube.com/embed/${
            member.musicURL
          }" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
          <p>â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â¤ï¸â­</p>
            `;
            $('#member-info').append(html);
          });
      }

      // ìˆ˜ì •, ì‚­ì œ ì•„ì´ì½˜ ìœ ë¨¸ ë²„íŠ¼
      function make_delete_fun() {
        alert('ë˜ ì†ìœ¼ì…¨ìŠµë‹ˆë‹¤. ì§€ë‚˜ê°„ ê±´ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      function make_change_fun() {
        alert('í›¼ì´í¬ì…ë‹ˆë‹¤. í•œ ë²ˆ ë±‰ì€ ë§ì€ ì£¼ì›Œ ë‹´ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      function make_rolling() {
        const commentWriter = $.trim($('#comment-writer').val());
        const commentPw = $('#comment-password').val();
        const commentContents = $.trim($('#comment-contents').val()).replace(
          /(?:\r\n|\r|\n)/g,
          '<br/>'
        );

        if (!commentWriter) {
          return alert('ì‘ì„±ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }

        if (!commentPw) {
          return alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }

        if (commentPw.match(/\s/g)) {
          return alert('ë¹„ë°€ë²ˆí˜¸ì—ëŠ” ê³µë°±ì´ ìˆìœ¼ë©´ ì•ˆ ë¼ìš”!');
        }

        if (!commentContents) {
          return alert('í•˜ê³  ì‹¶ì€ ë§ì„ ì ì–´ì£¼ì„¸ìš”.');
        }

        const rolling = {
          memberId: getMemberIdFromURL(),
          name: commentWriter,
          password: commentPw,
          comment: commentContents,
          date: moment().format('YYYY-MM-DD HH:mm:ss'),
        };

        const formData = new FormData();
        Object.entries(rolling).forEach(([key, value]) => {
          formData.append(key, value);
        });

        fetch('/api/rollingpaper', { method: 'POST', body: formData })
          .then((res) => res.json())
          .then((data) => {
            get_rolling();
          });
      }
      function get_rolling() {
        fetch(`/api/rollingpaper/${getMemberIdFromURL()}`, {
          method: 'GET',
        })
          .then((res) => res.json())
          .then((data) => {
            const { result, list } = data;
            if (result !== 'success') {
              alert(data.message);
              return;
            }
            $('#member-rollin-list').empty();
            const writeHtml = `
            <li class="member-comment-item write">
            <div class="inner" id="write_comment">
              <input
                type="text"
                name="ì‘ì„±ìëª…"
                id="comment-writer"
                placeholder="ì‘ì„±ìëª…ì„ ì ì–´ì£¼ì„¸ìš”."
                maxlength="8"
              />
              <input
                type="password"
                name="ì‘ì„± ë¹„ë°€ë²ˆí˜¸"
                id="comment-password"
                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì ì–´ì£¼ì„¸ìš”."
              />
              <textarea
                name="ì‘ì„± ë‚´ìš©"
                id="comment-contents"
                placeholder="í•  ë§ì„ ì ì–´ì£¼ì„¸ìš”."
              ></textarea>
              <button onclick="make_rolling()" class="write-comment-button">
                ë‹¤ ì ì—ˆì–´ìš”.
              </button>
              
            </div>
          </li>
            `;
            $('#member-rollin-list').append(writeHtml);
            list.forEach((rolling) => {
              const html = `
              <li class="member-comment-item">
              <div class="inner">
              <span class="comment-writer">${rolling.name}</span>
              <span class="comment-contents">${rolling.comment}</span>
              <span class="comment-date">${moment(rolling.date).format(
                'YYYYë…„ MMì›” DDì¼  HHì‹œmmë¶„'
              )}</span>
              
            </div>
            <button onclick="make_delete_fun()" class="delete-comment-button">
              ğŸ—‘ï¸
              </button>
              <button onclick="make_change_fun()" class="change-comment-button">
              âœï¸
              </button>
            </li>
              `;
              $('#member-rollin-list').append(html);
            });
          });
      }
    </script>
  </head>
  <body>
    <div class="wrap">
      <header class="title">
        <h1><a href="/">â­ì•Œì½©ì½©~! ë‹¬ì½©ì½©~!</a></h1>
        <button onclick="setIsGgamchingMode()" class="special-button">
          ğŸ’–
        </button>
        <span class="event-message"
          >í•˜íŠ¸ë¥¼ í´ë¦­í•˜ë©´ â­ê¹œì°¡ì´ ëª¨ë“œğŸ’•ë¥¼ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”!</span
        >
      </header>
      <section class="member-profile">
        <h2 class="hidden">íŒ€ì› ëˆ„êµ¬ëˆ„êµ¬ì˜ í”„ë¡œí•„</h2>
        <div class="member-image" id="member-image">
          <img src="" alt="ë©¤ë²„ ì´ë¯¸ì§€" />
        </div>
        <div class="member-info" id="member-info">
          <span>â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­â­â¤ï¸â­â¤ï¸â­â¤ï¸â­</span>
          <span>
            ì•ˆë…•í•˜ì„¸ìš”! ğŸ™Œ <br />
            ì•Œì½©ì½©ë‹¬ì½©ì½© íŒ€ì› ëˆ„êµ¬ëˆ„êµ¬ì…ë‹ˆë‹¤.
          </span>
          <span>ì–´ëŠì‹œì— ì‚´ê³ ìˆì–´ìš”.</span>
          <span>ì œ MBTIëŠ” INFPì—ìš”.</span>
          <span>ì €ëŠ” ì‰¬ëŠ” ë‚ ì—” ì´ê±°ì €ê±°ë¥¼ í•´ìš”.</span>
          <span
            >ì œ GitHubëŠ”
            <a href="https://github.com/ê³„ì •" target="_blank"
              >https://github.com/ê³„ì •</a
            >ì…ë‹ˆë‹¤.</span
          >
          <span>ëª¨ë‘ë“¤ ì˜ ë¶€íƒë“œë ¤ìš”.</span>
        </div>
      </section>
      <section class="member-comment">
        <h2>ì´ íŒ€ì›ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§...ğŸ˜®</h2>
        <ul class="member-comment-list" id="member-rollin-list">
          <li class="member-comment-item write">
            <div class="inner" id="write_comment">
              <input
                type="text"
                name="ì‘ì„±ìëª…"
                id="comment-writer"
                placeholder="ì‘ì„±ìëª…ì„ ì ì–´ì£¼ì„¸ìš”."
                maxlength="8"
              />

              <input
                type="password"
                name="ì‘ì„± ë¹„ë°€ë²ˆí˜¸"
                id="comment-password"
                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì ì–´ì£¼ì„¸ìš”."
              />
              <textarea
                name="ì‘ì„± ë‚´ìš©"
                id="comment-contents"
                placeholder="í•  ë§ì„ ì ì–´ì£¼ì„¸ìš”."
              ></textarea>
              <button onclick="make_rolling()" class="write-comment-button">
                ë‹¤ ì ì—ˆì–´ìš”!
              </button>
            </div>
          </li>
        </ul>
      </section>
    </div>
  </body>
</html>
